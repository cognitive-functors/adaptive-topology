# C4 для пользователей Agda

Разбор формальной верификации основных теорем C4 в Agda с замечаниями о технике доказательств, флаге `--without-K` и возможностях для вклада.

---

## Обзор

Математическая основа C4 -- конечная абелева группа Z3^3 = Z3 x Z3 x Z3 с 27 элементами. Все 11 основных теорем механически верифицированы в Agda (ассистент доказательств на основе зависимых типов и теории типов Мартин-Лёфа).

**Исходный файл:** `formal-proofs/c4-comp-v5.agda`

---

## Типовая структура

### Базовый тип: Z3

Z3 (целые по модулю 3) определяется как конечный тип с тремя конструкторами:

```agda
data Z3 : Set where
 z0 : Z3
 z1 : Z3
 z2 : Z3
```

Это представляет {0, 1, 2} с модулярной арифметикой. Сложение определяется сопоставлением с образцом по всем 9 случаям.

### Когнитивное состояние: Z3 x Z3 x Z3

Когнитивное состояние (базисное состояние) -- это тройка:

```agda
CogState : Set
CogState = Z3 x Z3 x Z3
```

Где три компонента:
- Первый: T (Время)
- Второй: D (Масштаб)
- Третий: A (Агентность, agency)

### Операторы

Три когнитивных оператора сдвигают одну компоненту на +1 (mod 3):

```agda
shiftT : CogState -> CogState
shiftT (t , d , i) = (add t z1 , d , i)

shiftD : CogState -> CogState
shiftD (t , d , i) = (t , add d z1 , i)

shiftI : CogState -> CogState
shiftI (t , d , i) = (t , d , add i z1)
```

Каждый оператор является элементом группы; его тройное применение возвращает к исходному состоянию (порядок 3).

---

## Ключевые теоремы

### Теорема 1: Полнота (достижимость)

Любое когнитивное состояние достижимо из любого другого через конечную композицию операторов.

```agda
reachability : (s1 s2 : CogState) -> Path s1 s2
```

**Стратегия доказательства:** Конструктивная. Для данных s1 = (t1, d1, i1) и s2 = (t2, d2, i2) вычисляется разность по каждой оси (mod 3) и применяется соответствующее число сдвигов. Терм доказательства явно конструирует путь.

### Теорема 9: Кратчайший путь (конструктивный)

Алгоритм `belief-path` вычисляет кратчайшую последовательность преобразований:

```agda
belief-path : CogState -> CogState -> List Operator
```

Доказательство показывает, что длина этого пути равна расстоянию Хэмминга между двумя состояниями (число осей, по которым они различаются). Максимальная длина: 3.

### Теоремы 3-8: Групповые свойства

- **Ассоциативность:** Композиция операторов ассоциативна.
- **Единица:** Существует единичный оператор (без сдвига по любой оси).
- **Обратный элемент:** Каждый оператор имеет обратный (сдвиг на +2 эквивалентен сдвигу на -1 в Z3).
- **Коммутативность:** Группа абелева -- порядок применения операторов не имеет значения.

Эти свойства верифицируются полным перебором случаев на конечном типе, что Agda обрабатывает эффективно.

### Теорема 11: Ограниченный диаметр

Максимальное расстояние Хэмминга между любыми двумя состояниями равно 3, то есть не более 3 применений операторов достаточно для достижения любого состояния из любого другого.

---

## Флаг `--without-K`

Доказательства компилируются с `--without-K`, что отключает аксиому K Штрайхера (единственность доказательств тождества). Это гарантирует, что доказательства корректны в гомотопической теории типов (HoTT) и не зависят от предположения, что все доказательства равенства идентичны.

**Почему это важно:**
- Доказательства остаются корректными при более общих теоретико-типовых интерпретациях.
- Никаких скрытых аксиом за пределами теории типов Мартин-Лёфа.
- Доказательства конструктивны: они вычисляют свидетелей, а не только утверждают существование.

**Практическое следствие:** Некоторые доказательства равенства требуют явного транспорта вдоль путей вместо прямого сопоставления с образцом по `refl`. Это добавляет многословности, но повышает строгость.

---

## Заметки о технике доказательств

### Разрешимое равенство

Z3 обладает разрешимым равенством (мы всегда можем определить, равны два элемента или нет). Это устанавливается в первую очередь и используется повсюду:

```agda
_==Z3_ : Z3 -> Z3 -> Bool
z0 ==Z3 z0 = true
z0 ==Z3 z1 = false
...
```

### Полный перебор случаев

Поскольку Z3 содержит лишь 3 элемента, Z3^3 содержит 27. Многие доказательства проводятся полным перебором всех 27 (или 27 x 27 = 729) случаев. Проверка завершаемости Agda принимает это непосредственно.

### Эквациональное рассуждение

Для алгебраических свойств (ассоциативность, коммутативность) доказательства используют комбинаторы эквационального рассуждения Agda:

```agda
comm-proof : (a b : Z3) -> add a b == add b a
comm-proof z0 z0 = refl
comm-proof z0 z1 = refl
...
```

---

## Сборка и проверка

### Предварительные требования

- Agda >= 2.6.3
- Стандартная библиотека Agda >= 1.7

### Верификация

```bash
agda --without-K formal-proofs/c4-comp-v5.agda
```

Если файл проходит проверку типов без ошибок, все теоремы верифицированы. Система типов Agda гарантирует, что терм типа `(s1 s2 : CogState) -> Path s1 s2` является корректным доказательством достижимости.

---

## Открытый вклад: Теорема 2 (минимальность)

**Гипотеза 2:** Три измерения *необходимы* -- никакая двумерная модель (Z3^2 или любая другая группа с менее чем 27 элементами) не может охватить ту же структуру.

**Статус:** Не доказана. Это основная открытая проблема формальной верификации C4.

**Что потребуется для доказательства:**
1. Формально определить, что значит "охватить ту же структуру" (какие свойства должны сохраняться?).
2. Показать, что любая группа с менее чем 27 элементами не удовлетворяет хотя бы одному требуемому свойству.
3. Наиболее сложная часть: формализовать *эмпирическое* утверждение (что T, D, A -- различные, несводимые оси) способом, допускающим доказательство.

**Возможные подходы:**
- Показать, что проекция Z3^3 на любую Z3^2 теряет определённое структурное свойство (например, пара состояний становится неразличимой, которая должна быть различимой).
- Формализовать "адекватную когнитивную модель" аксиоматически и вывести нижнюю границу.

**Как внести вклад:**
- Сделать форк репозитория.
- Работать в директории `formal-proofs/`.
- Отправить pull request с доказательством или частичным прогрессом.
- Обсуждение: создать issue на GitHub с меткой `theorem-2`.

---

## Структура файлов

```
formal-proofs/
 c4-comp-v5.agda -- Основной файл доказательств (все 11 теорем)
 README.md -- Инструкции по сборке
 VERIFICATION-GUIDE.md -- Подробное руководство по верификации
```

---

## Литература

- Norell, U. (2009). "Dependently Typed Programming in Agda."
- Univalent Foundations Program (2013). *Homotopy Type Theory*.
- Selyutin, I. & Kovalev, N. (2025). "C4: Complete Cognitive Coordinate System." Preprint.

---

*Контакт: comonoid@yandex.ru*
